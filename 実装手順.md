# 実装・デプロイ手順書

## ステップ1: Google Apps Scriptプロジェクトの作成

### 1.1 プロジェクト作成
1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「LIFESUPPORT(HK) セキュアアンケートシステム」に変更

### 1.2 ファイルのアップロード
以下のファイルをGASプロジェクトにアップロード：

1. **Code.gs** - メイン処理コード
2. **SupabaseAuth.gs** - Supabase認証システム
3. **SecureSurvey.gs** - セキュアアンケート機能
4. **SheetMapping.gs** - シートマッピング機能
5. **PDFExport.gs** - PDF変換・メール送信機能
6. **SystemIntegration.gs** - システム統合機能
7. **MCPIntegration.gs** - MCP Supabase連携
8. **appsscript.json** - 設定ファイル

### 1.3 設定値の更新
```javascript
// Code.gs内の設定値を実際の値に更新
const CONFIG = {
  COMPANY_NAME: 'LIFESUPPORT(HK)LIMITED',
  COMPANY_ADDRESS: 'No 163 Pan Chung, Tai Po, N.T.,HK',
  COMPANY_TEL: '(852)52263586',
  COMPANY_FAX: '(852)26530426',
  COMPANY_WEBSITE: 'https://lshk-ai-service.studio.site/',
  NOTIFICATION_EMAIL: 'bestinksalesman@gmail.com',
  PROJECT_ID: 'cantonese-katakana',
  SERVICE_ACCOUNT_EMAIL: 'id-351@cantonese-katakana.iam.gserviceaccount.com'
};
```

## ステップ2: Supabaseデータベースの初期化

### 2.1 Supabaseプロジェクト設定
1. [Supabase Dashboard](https://supabase.com/dashboard) にアクセス
2. プロジェクト `ihviwvlptzalbrjktddf` を選択
3. データベース設定を確認

### 2.2 データベーステーブル作成
```javascript
// MCPIntegration.gsの関数を実行
function initializeSupabaseDatabase() {
  // テーブル作成処理
  createSupabaseTablesViaMCP();
}
```

### 2.3 認証設定
- Supabase Auth設定の確認
- メール認証設定
- セキュリティポリシー設定

## ステップ3: 認証システムの実装

### 3.1 会員登録フォーム作成
```javascript
// SupabaseAuth.gsの関数を実行
function createMemberRegistrationForm() {
  // 会員登録フォーム作成
}
```

### 3.2 認証フロー実装
1. 会員登録処理
2. メール認証処理
3. ログイン処理
4. セッション管理

### 3.3 認証テスト
- 正常ログインテスト
- 不正ログインテスト
- セッション管理テスト

## ステップ4: セキュアアンケートフォームの作成

### 4.1 アンケートフォーム作成
```javascript
// SecureSurvey.gsの関数を実行
function createSecureSurveyForm() {
  // セキュアアンケートフォーム作成
}
```

### 4.2 セキュリティ設定
- 認証チェック機能
- データ検証設定
- セキュリティレベル判定

### 4.3 フォームテスト
- 認証済みアクセステスト
- 未認証アクセステスト
- データ送信テスト

## ステップ5: システム統合テスト

### 5.1 初期化テスト
```javascript
// SystemIntegration.gsの関数を実行
function initializeSystem() {
  // システム全体の初期化
}
```

### 5.2 機能テスト
- 会員登録・認証テスト
- アンケート回答テスト
- データ処理テスト
- メール送信テスト

### 5.3 セキュリティテスト
- 認証トークンテスト
- データ保護テスト
- アクセス制御テスト

## ステップ6: 本番環境デプロイ

### 6.1 本番環境設定
- 本番用設定値の適用
- セキュリティ設定の強化
- 監視設定の有効化

### 6.2 デプロイ実行
- トリガー設定
- 自動処理の開始
- 監視体制の構築

### 6.3 運用開始
- システム監視
- ログ確認
- エラー対応

## トラブルシューティング

### よくある問題
1. **認証エラー**: Supabase設定の確認
2. **API制限**: Google API制限の確認
3. **メール送信エラー**: Gmail API設定の確認
4. **データベースエラー**: Supabase接続の確認

### 解決方法
1. ログの確認
2. 設定値の確認
3. 権限の確認
4. 接続テストの実行

## 監視・メンテナンス

### 定期作業
- ログの確認
- エラーの確認
- パフォーマンスの確認
- セキュリティの確認

### 緊急時対応
- システム停止時の対応
- データ漏洩時の対応
- セキュリティインシデント対応

