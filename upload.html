<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>書類アップロード - LIFESUPPORT(HK)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .logo-img {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: block;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        select, input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        select:focus, input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .upload-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .upload-btn:hover {
            background: #5568d3;
        }
        
        .upload-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 2px solid #667eea;
            display: none;
        }
        
        .result-box.show {
            display: block;
        }
        
        .result-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .result-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .result-label {
            font-weight: bold;
            color: #666;
        }
        
        .result-value {
            color: #333;
            margin-left: 10px;
        }
        
        .success-message {
            color: #28a745;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .error-message {
            color: #dc3545;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .company-info {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            font-size: 0.9rem;
            color: #999;
        }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
        
        .note-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .auto-fill-section {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .auto-fill-title {
            color: #28a745;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .survey-link {
            background: #667eea;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
            transition: background 0.3s;
        }
        
        .survey-link:hover {
            background: #5568d3;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="lifesupport-logo.png" alt="LIFESUPPORT(HK)LIMITED" class="logo-img">
        <h1>LIFESUPPORT(HK)LIMITED</h1>
        <p class="subtitle">書類アップロードシステム</p>
        
        <!-- 本人確認書類セクション -->
        <div class="section">
            <h2 class="section-title">📄 本人確認書類のアップロード</h2>
            
            <div class="note">
                <div class="note-title">⚠️ 重要なお知らせ</div>
                <p>画像をアップロードすると、OCR（光学文字認識）により自動的に名前・住所・郵便番号が抽出されます。抽出された情報はアンケートフォームに自動入力されます。</p>
            </div>
            
            <div class="form-group">
                <label for="identityDocType">書類の種類を選択してください *</label>
                <select id="identityDocType" required>
                    <option value="">-- 選択してください --</option>
                    <option value="パスポート">パスポート</option>
                    <option value="マイナンバーカード住所記載面">マイナンバーカード住所記載面</option>
                    <option value="国際運転免許証">国際運転免許証</option>
                    <option value="住民票">住民票</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="identityFile">画像ファイルを選択してください *</label>
                <input type="file" id="identityFile" accept="image/*" required>
            </div>
            
            <button class="upload-btn" onclick="uploadIdentityDocument()">
                本人確認書類をアップロード
            </button>
            
            <div class="loading" id="identityLoading">
                <div class="spinner"></div>
                <p>アップロード中... OCR処理を実行しています</p>
            </div>
            
            <div class="result-box" id="identityResult">
                <div class="result-title">✅ アップロード完了</div>
                <div id="identityResultContent"></div>
            </div>
            
            <!-- OCR結果の自動入力セクション -->
            <div class="auto-fill-section" id="autoFillSection" style="display: none;">
                <div class="auto-fill-title">📝 OCR結果の確認と修正</div>
                <p>以下の情報がOCRで抽出されました。内容を確認し、必要に応じて修正してください。</p>
                
                <div class="form-group">
                    <label for="extractedName">お名前 *</label>
                    <input type="text" id="extractedName" class="form-input" placeholder="OCRで抽出された名前">
                </div>
                
                <div class="form-group">
                    <label for="extractedPostalCode">郵便番号 *</label>
                    <input type="text" id="extractedPostalCode" class="form-input" placeholder="OCRで抽出された郵便番号">
                </div>
                
                <div class="form-group">
                    <label for="extractedAddress">住所 *</label>
                    <input type="text" id="extractedAddress" class="form-input" placeholder="OCRで抽出された住所">
                </div>
                
                <button class="upload-btn" onclick="openSurveyWithAutoFill()">
                    📋 アンケートフォームを開く（自動入力）
                </button>
            </div>
        </div>
        
        <!-- 事業活動証明書類セクション -->
        <div class="section">
            <h2 class="section-title">🏢 事業活動証明書類のアップロード</h2>
            
            <div class="note">
                <div class="note-title">📝 提出書類について</div>
                <p>会社案内、ホームページのスクリーンショット、賃貸契約書などをアップロードしてください。</p>
            </div>
            
            <div class="form-group">
                <label for="businessDocType">書類の種類を選択してください *</label>
                <select id="businessDocType" required>
                    <option value="">-- 選択してください --</option>
                    <option value="会社案内">会社案内</option>
                    <option value="ホームページ">ホームページ</option>
                    <option value="賃貸契約書">賃貸契約書</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="businessFile">画像ファイルを選択してください *</label>
                <input type="file" id="businessFile" accept="image/*" required>
            </div>
            
            <button class="upload-btn" onclick="uploadBusinessDocument()">
                事業活動証明書類をアップロード
            </button>
            
            <div class="loading" id="businessLoading">
                <div class="spinner"></div>
                <p>アップロード中...</p>
            </div>
            
            <div class="result-box" id="businessResult">
                <div class="result-title">✅ アップロード完了</div>
                <div id="businessResultContent"></div>
            </div>
        </div>
        
        <div class="company-info">
            <strong>LIFESUPPORT(HK)LIMITED</strong><br>
            No 163 Pan Chung, Tai Po, N.T., HK<br>
            Tel: (852)52263586<br>
            Website: <a href="https://lshk-ai-service.studio.site/" style="color: #667eea;">lshk-ai-service.studio.site</a>
        </div>
    </div>
    
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzvOHWc3BbVRJMOLhxMXEWDG3zZNT9iJBdLaCgtv-4Fsxq7v03HOGeFfDFTrVG1Ow-y/exec'; // Google Apps ScriptのWebアプリケーションURL
        const SURVEY_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfOParTZ0EJElORcS6xxqm_KfQp5Xz4_-pZ0X1_s9zc8PmRoA/viewform'; // アンケートフォームのURL（修復済み）
        
        async function uploadIdentityDocument() {
            const docType = document.getElementById('identityDocType').value;
            const fileInput = document.getElementById('identityFile');
            const file = fileInput.files[0];
            
            if (!docType) {
                alert('書類の種類を選択してください');
                return;
            }
            
            if (!file) {
                alert('ファイルを選択してください');
                return;
            }
            
            // ローディング表示
            document.getElementById('identityLoading').classList.add('show');
            document.getElementById('identityResult').classList.remove('show');
            
            try {
                const formData = new FormData();
                formData.append('uploadType', 'identity');
                formData.append('documentType', docType);
                formData.append('file', file);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // ローディング非表示
                document.getElementById('identityLoading').classList.remove('show');
                
                if (result.success) {
                    // 結果表示
                    let resultHTML = `
                        <div class="success-message">✅ アップロードが完了しました</div>
                        <div class="result-item">
                            <span class="result-label">ファイル名:</span>
                            <span class="result-value">${result.fileName}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ファイルURL:</span>
                            <span class="result-value"><a href="${result.fileUrl}" target="_blank">確認する</a></span>
                        </div>
                    `;
                    
                    if (result.ocrResult) {
                        resultHTML += `
                            <div class="result-item">
                                <span class="result-label">OCR抽出結果:</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">お名前:</span>
                                <span class="result-value">${result.ocrResult.name || '抽出できませんでした'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">郵便番号:</span>
                                <span class="result-value">${result.ocrResult.postalCode || '抽出できませんでした'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">住所:</span>
                                <span class="result-value">${result.ocrResult.address || '抽出できませんでした'}</span>
                            </div>
                            <div class="note" style="margin-top: 15px;">
                                <p>※ これらの情報はアンケートフォームに自動入力されます。内容を確認し、必要に応じて修正してください。</p>
                            </div>
                        `;
                        
                        // OCR結果を自動入力フィールドに設定
                        document.getElementById('extractedName').value = result.ocrResult.name || '';
                        document.getElementById('extractedPostalCode').value = result.ocrResult.postalCode || '';
                        document.getElementById('extractedAddress').value = result.ocrResult.address || '';
                        
                        // 自動入力セクションを表示
                        document.getElementById('autoFillSection').style.display = 'block';
                    }
                    
                    document.getElementById('identityResultContent').innerHTML = resultHTML;
                    document.getElementById('identityResult').classList.add('show');
                } else {
                    document.getElementById('identityResultContent').innerHTML = `
                        <div class="error-message">❌ エラー: ${result.error}</div>
                    `;
                    document.getElementById('identityResult').classList.add('show');
                }
            } catch (error) {
                document.getElementById('identityLoading').classList.remove('show');
                document.getElementById('identityResultContent').innerHTML = `
                    <div class="error-message">❌ エラーが発生しました: ${error.message}</div>
                `;
                document.getElementById('identityResult').classList.add('show');
            }
        }
        
        async function uploadBusinessDocument() {
            const docType = document.getElementById('businessDocType').value;
            const fileInput = document.getElementById('businessFile');
            const file = fileInput.files[0];
            
            if (!docType) {
                alert('書類の種類を選択してください');
                return;
            }
            
            if (!file) {
                alert('ファイルを選択してください');
                return;
            }
            
            // ローディング表示
            document.getElementById('businessLoading').classList.add('show');
            document.getElementById('businessResult').classList.remove('show');
            
            try {
                const formData = new FormData();
                formData.append('uploadType', 'business');
                formData.append('documentType', docType);
                formData.append('file', file);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // ローディング非表示
                document.getElementById('businessLoading').classList.remove('show');
                
                if (result.success) {
                    // 結果表示
                    const resultHTML = `
                        <div class="success-message">✅ アップロードが完了しました</div>
                        <div class="result-item">
                            <span class="result-label">ファイル名:</span>
                            <span class="result-value">${result.fileName}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ファイルURL:</span>
                            <span class="result-value"><a href="${result.fileUrl}" target="_blank">確認する</a></span>
                        </div>
                    `;
                    
                    document.getElementById('businessResultContent').innerHTML = resultHTML;
                    document.getElementById('businessResult').classList.add('show');
                } else {
                    document.getElementById('businessResultContent').innerHTML = `
                        <div class="error-message">❌ エラー: ${result.error}</div>
                    `;
                    document.getElementById('businessResult').classList.add('show');
                }
            } catch (error) {
                document.getElementById('businessLoading').classList.remove('show');
                document.getElementById('businessResultContent').innerHTML = `
                    <div class="error-message">❌ エラーが発生しました: ${error.message}</div>
                `;
                document.getElementById('businessResult').classList.add('show');
            }
        }
        
        // アンケートフォームを開く関数（自動入力付き）
        function openSurveyWithAutoFill() {
            const name = document.getElementById('extractedName').value;
            const postalCode = document.getElementById('extractedPostalCode').value;
            const address = document.getElementById('extractedAddress').value;
            
            if (!name || !postalCode || !address) {
                alert('すべてのフィールドを入力してください');
                return;
            }
            
            // アンケートフォームのURL
            const surveyUrl = SURVEY_URL;
            
            // URLパラメータとして情報を渡す
            const params = new URLSearchParams({
                name: name,
                postalCode: postalCode,
                address: address,
                autoFill: 'true'
            });
            
            const fullUrl = `${surveyUrl}?${params.toString()}`;
            
            // 新しいタブでアンケートフォームを開く
            window.open(fullUrl, '_blank');
        }
    </script>
</body>
</html>
