# デプロイ手順書

## システムデプロイ手順

### ステップ1: Google Apps Scriptプロジェクトの作成

1. **Google Apps Scriptにアクセス**
   - [https://script.google.com/](https://script.google.com/) にアクセス
   - Googleアカウントでログイン

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を「Googleアンケート自動集計システム」に変更

3. **プロジェクト設定**
   - プロジェクトID: `cantonese-katakana`
   - プロジェクト番号: `451113233741`

### ステップ2: ファイルのアップロード

1. **Code.gs**
   - メイン処理コードをコピー&ペースト

2. **SheetMapping.gs**
   - シートマッピング機能をコピー&ペースト

3. **PDFExport.gs**
   - PDF変換・メール送信機能をコピー&ペースト

4. **SystemIntegration.gs**
   - システム統合機能をコピー&ペースト

5. **appsscript.json**
   - 設定ファイルをコピー&ペースト

### ステップ3: 認証設定

1. **サービスアカウント認証**
   ```
   サービスアカウント: id-351@cantonese-katakana.iam.gserviceaccount.com
   JSONキーファイル: cantonese-katakana-5155a818b800.json
   ```

2. **必要なAPIの有効化**
   - [Google Cloud Console](https://console.cloud.google.com/) にアクセス
   - プロジェクト `cantonese-katakana` を選択
   - 以下のAPIを有効化：
     - Google Forms API
     - Google Sheets API
     - Gmail API
     - Google Drive API

3. **権限設定**
   - サービスアカウントに適切な権限を付与
   - スプレッドシートとフォームへのアクセス権限

### ステップ4: 設定値の更新

1. **Code.gs内の設定値**
   ```javascript
   // 実際のフォームIDに置き換え（フォーム作成後に取得）
   const formId = 'YOUR_FORM_ID';
   
   // 実際のシートIDに置き換え（シート作成後に取得）
   const sheetId = 'YOUR_SHEET_ID';
   ```

2. **通知メールアドレスの確認**
   ```javascript
   NOTIFICATION_EMAIL: 'bestinksalesman@gmail.com'
   ```

### ステップ5: 初期化とテスト

1. **システム初期化**
   ```javascript
   function initializeSystem() {
     // システム全体の初期化を実行
   }
   ```

2. **フォーム作成**
   ```javascript
   function createSurveyForm() {
     // アンケートフォームを作成
   }
   ```

3. **テスト実行**
   - フォーム作成テスト
   - 回答受信テスト
   - シート登録テスト
   - メール送信テスト

### ステップ6: トリガー設定

1. **自動トリガーの設定**
   - 5分ごとの新しい回答チェック
   - 1時間ごとのバッチ処理

2. **トリガーの確認**
   ```javascript
   function setupTriggers() {
     // トリガー設定を実行
   }
   ```

### ステップ7: 本番環境デプロイ

1. **本番環境でのテスト**
   - 実際のフォームで回答テスト
   - メール送信テスト
   - PDF変換テスト

2. **監視設定**
   - ログ監視の設定
   - エラー通知の設定

3. **バックアップ設定**
   - 定期的なデータバックアップ
   - 設定ファイルのバックアップ

## トラブルシューティング

### よくある問題と解決方法

#### 1. 認証エラー
**問題**: サービスアカウント認証が失敗する
**解決方法**:
- JSONキーファイルのパスを確認
- サービスアカウントの権限を確認
- APIの有効化状況を確認

#### 2. フォーム作成エラー
**問題**: フォームが作成できない
**解決方法**:
- Google Forms APIの権限を確認
- フォーム作成権限を確認

#### 3. メール送信エラー
**問題**: メールが送信されない
**解決方法**:
- Gmail APIの権限を確認
- 送信先メールアドレスを確認
- スパムフィルターの設定を確認

#### 4. シートアクセスエラー
**問題**: シートにアクセスできない
**解決方法**:
- Google Sheets APIの権限を確認
- シートの共有設定を確認

### ログの確認方法

1. **Google Apps Scriptの実行ログ**
   - スクリプトエディタで「実行」→「ログを表示」

2. **エラーログの分析**
   - エラーメッセージを詳細に確認
   - スタックトレースを確認

3. **デバッグ方法**
   - `console.log()` を使用したデバッグ
   - 段階的なテスト実行

## メンテナンス

### 定期メンテナンス

1. **週次メンテナンス**
   - ログの確認
   - エラーの確認
   - システム状態の確認

2. **月次メンテナンス**
   - データのバックアップ
   - 設定の見直し
   - パフォーマンスの確認

3. **四半期メンテナンス**
   - システム全体の見直し
   - 新機能の検討
   - セキュリティの確認

### バックアップ

1. **データバックアップ**
   - スプレッドシートの定期的なバックアップ
   - フォーム設定のバックアップ

2. **設定バックアップ**
   - スクリプトファイルのバックアップ
   - 設定値のバックアップ

3. **復旧手順**
   - バックアップからの復旧手順
   - 緊急時の対応手順

## セキュリティ

### セキュリティ考慮事項

1. **アクセス権限**
   - 最小権限の原則
   - 定期的な権限見直し

2. **データ保護**
   - 個人情報の適切な取り扱い
   - データの暗号化

3. **監査ログ**
   - アクセスログの記録
   - 操作ログの記録

4. **定期的なセキュリティ確認**
   - 権限の見直し
   - アクセスログの確認
   - セキュリティ更新の適用

