# Googleアンケート自動集計・自動送信システム 設定手順

## 前提条件

- Googleアカウント
- Google Apps Scriptへのアクセス権限
- サービスアカウントJSONキーファイル

## 詳細設定手順

### ステップ1: Google Apps Scriptプロジェクト作成

1. **Google Apps Scriptにアクセス**
   - [https://script.google.com/](https://script.google.com/) にアクセス
   - Googleアカウントでログイン

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を「Googleアンケート自動集計システム」に変更

3. **プロジェクト設定**
   - プロジェクトID: `cantonese-katakana`
   - プロジェクト番号: `451113233741`

### ステップ2: 認証設定

1. **サービスアカウント認証**
   ```
   サービスアカウント: id-351@cantonese-katakana.iam.gserviceaccount.com
   JSONキーファイル: cantonese-katakana-5155a818b800.json
   ```

2. **必要なAPIの有効化**
   - Google Forms API
   - Google Sheets API
   - Gmail API
   - Google Drive API

3. **権限設定**
   - サービスアカウントに適切な権限を付与
   - スプレッドシートとフォームへのアクセス権限

### ステップ3: コード実装

1. **メインコードの配置**
   - `Code.gs`ファイルの内容をコピー&ペースト
   - 設定値を実際の値に更新

2. **設定値の更新**
   ```javascript
   // 実際のフォームIDに置き換え
   const formId = 'YOUR_FORM_ID';
   
   // 実際のシートIDに置き換え
   const sheetId = 'YOUR_SHEET_ID';
   ```

3. **トリガー設定**
   - 5分ごとの自動実行トリガー
   - フォーム送信時の即座実行トリガー

### ステップ4: フォーム作成

1. **フォーム作成関数の実行**
   ```javascript
   function createSurveyForm() {
     // フォーム作成処理
   }
   ```

2. **フォーム設定**
   - タイトル: "LIFESUPPORT(HK) アンケート"
   - 説明文の設定
   - 回答先シートの設定

3. **質問項目の設定**
   - 基本情報（名前、会社名、連絡先）
   - アンケート内容（満足度、サービス利用状況）
   - 自由記述欄

### ステップ5: シート設定

1. **回答先シートの作成**
   - 自動でシートが作成される
   - ヘッダー行の自動設定

2. **データマッピング**
   - PDFフォーマット（format-hk1.pdf）に基づく設計
   - 自動データ入力機能

3. **シート完成機能**
   - 入力データの自動マッピング
   - フォーマットの自動適用

### ステップ6: メール設定

1. **通知メール設定**
   - 送信先: `bestinksalesman@gmail.com`
   - 件名と本文の設定

2. **PDF添付メール設定**
   - シートのPDF変換
   - メール添付送信

### ステップ7: テスト・デプロイ

1. **機能テスト**
   - フォーム作成テスト
   - 回答受信テスト
   - シート登録テスト
   - メール送信テスト

2. **本番環境デプロイ**
   - トリガーの有効化
   - 自動処理の開始

## 設定ファイル

### appsscript.json
```json
{
  "timeZone": "Asia/Tokyo",
  "dependencies": {
    "enabledAdvancedServices": [
      {
        "userSymbol": "Sheets",
        "serviceId": "sheets",
        "version": "v4"
      },
      {
        "userSymbol": "Gmail",
        "serviceId": "gmail",
        "version": "v1"
      },
      {
        "userSymbol": "Drive",
        "serviceId": "drive",
        "version": "v3"
      }
    ]
  },
  "exceptionLogging": "STACKDRIVER",
  "runtimeVersion": "V8"
}
```

## トラブルシューティング

### 認証エラー
- JSONキーファイルのパスを確認
- サービスアカウントの権限を確認
- APIの有効化状況を確認

### フォーム作成エラー
- Google Forms APIの権限を確認
- フォーム作成権限を確認

### メール送信エラー
- Gmail APIの権限を確認
- 送信先メールアドレスを確認
- スパムフィルターの設定を確認

### シートアクセスエラー
- Google Sheets APIの権限を確認
- シートの共有設定を確認

## 監視・メンテナンス

### ログ監視
- Google Apps Scriptの実行ログを定期確認
- エラーログの分析

### データバックアップ
- 定期的なシートデータのバックアップ
- フォーム設定のバックアップ

### システム更新
- 定期的なコードの見直し
- 新機能の追加検討

## セキュリティ考慮事項

- サービスアカウントキーの適切な管理
- アクセス権限の最小化
- 定期的な権限見直し
- ログの監視と分析
